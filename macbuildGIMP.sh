#!/bin/sh

# macbuildGIMP.sh
# Builds RawTherapee on macOS 10.15.4 / Xcode 11.4.1
# Depends on libraries built by https://github.com/Benitoite/RTdeps/blob/master/macbuildRT.sh
#
#
# Created by Richard Barber on 05/09/20.
#
# PREREQUISITE: nettle requires MacTeX http://tug.org/cgi-bin/mactex-download/MacTeX.pkg
# PREREQUISITE: GIMP requires PyGTK2 @ https://sourceforge.net/projects/macpkg/files/PyGTK/2.24.0/
#
# GIT DEPENDENCIES

cd ~
git clone https://gitlab.gnome.org/GNOME/gimp.git
git clone https://github.com/LuaDist/libmng.git
git clone https://gitlab.freedesktop.org/xorg/lib/libxpm.git
git clone https://github.com/caolanm/libwmf.git
git clone git://git.webkit.org/WebKit.git
git clone https://gitlab.gnome.org/GNOME/babl.git
git clone https://gitlab.gnome.org/GNOME/gegl.git
git clone https://gitlab.gnome.org/GNOME/gtk.git gtk2
git clone https://gitlab.gnome.org/GNOME/glibmm.git gtkmm2
git clone https://gitlab.gnome.org/GNOME/json-glib.git
git clone https://gitlab.gnome.org/World/intltool.git
git clone https://gitlab.gnome.org/GNOME/glib-networking.git
git clone https://git.savannah.gnu.org/git/autogen.git
git clone https://github.com/ivmai/bdwgc.git
git clone https://github.com/gnutls/nettle.git
git clone https://github.com/p11-glue/p11-kit.git
git clone https://gitlab.com/gnutls/libtasn1.git
git clone https://gitlab.gnome.org/GNOME/gexiv2
git clone https://github.com/hughsie/appstream-glib.git
git clone https://github.com/libarchive/libarchive.git
git clone https://gitlab.gnome.org/GNOME/libsoup.git
git clone https://github.com/rockdaboot/libpsl.git
git clone https://github.com/rpm-software-management/rpm.git
git clone https://dev.gnupg.org/source/libgcrypt.git
git clone https://github.com/GPGTools/MacGPG2.git
git clone https://github.com/gpg/libgpg-error.git
git clone https://dev.gnupg.org/source/libassuan.git
git clone https://dev.gnupg.org/source/libksba.git
git clone https://dev.gnupg.org/source/npth.git
git clone https://github.com/rpm-software-management/popt.git
git clone https://github.com/yaml/libyaml.git
git clone https://gitlab.gnome.org/GNOME/gexiv2.git
git clone https://gitlab.gnome.org/GNOME/vala.git
git clone https://gitlab.com/graphviz/graphviz.git
git clone https://github.com/mypaint/libmypaint.git
git clone https://github.com/json-c/json-c.git
git clone https://github.com/mypaint/mypaint-brushes.git
git clone https://github.com/freedesktop/poppler.git
git clone https://github.com/uclouvain/openjpeg.git
git clone https://anongit.freedesktop.org/git/poppler/poppler-data.git
git clone https://github.com/GNOME/gjs.git
git clone https://github.com/ptomato/mozjs.git
git clone https://luajit.org/git/luajit-2.0.git
git clone https://gitlab.gnome.org/GNOME/pygobject.git

curl http://ftp.gnu.org/gnu/autogen/rel5.18.16/autogen-5.18.16.tar.xz -o autogen.xz && tar xf autogen.xz && rm autogen.xz && mv autogen-5* autogen
curl https://gmplib.org/download/gmp/gmp-6.2.0.tar.xz -o gmp.xz && tar xf gmp.xz && rm gmp.xz && mv gmp-6* gmp
curl https://ftp.gnu.org/gnu/libunistring/libunistring-0.9.10.tar.xz -o libunistring.xz && tar xf libunistring.xz && rm libunistring.xz && mv libunistring-0* libunistring
curl http://dist.schmorp.de/libev/libev-4.33.tar.gz -o libev.gz && gunzip libev.gz && tar xf libev && rm libev && mv libev-4* libev4
curl https://www.gnupg.org/ftp/gcrypt/gnutls/v3.6/gnutls-3.6.13.tar.xz -o gnutls.xz &&  tar xf gnutls.xz && rm gnutls.xz && mv gnutls-3* gnutls
curl https://gnupg.org/ftp/gcrypt/gnupg/gnupg-2.2.20.tar.bz2 -o gnupg.bz2 && tar xvfj gnupg.bz2 && rm gnupg.bz2 && mv gnupg-2* gnupg
curl https://astron.com/pub/file/file-5.38.tar.gz -o file-5.gz && gunzip file-5.gz && cd file-5 && tar xf file-5 && rm file-5 && mv file-5* file-5
curl https://download.oracle.com/berkeley-db/db-4.8.30.tar.gz -o db4.gz && gunzip db4.gz && tar xf db4 && rm db4 && mv db-4* db-4
curl https://www.lua.org/ftp/lua-5.3.5.tar.gz -o lua.gz && gunzip lua.gz && tar xf lua && rm lua && mv lua-5* lua-5
curl -L https://download.gnome.org/sources/vala/0.48/vala-0.48.5.tar.xz -o vala.xz && tar xf vala.xz && rm vala.xz && mv vala-0* vala-0
curl http://ftp.gnome.org/pub/GNOME/sources/pygtk/2.24/pygtk-2.24.0.tar.bz2 -o pygtk.bz2 && tar xvfj pygtk.bz2 && rm pygtk.bz2

# Prepare dependencies

sudo install_name_tool -change libfreetype.6.dylib /opt/local/lib/libfreetype.6.dylib  /opt/local/bin/rsvg-convert
sudo install_name_tool -change libz.1.dylib /opt/local/lib/libz.1.dylib /opt/local/lib/libfreetype.6.dylib
sudo install_name_tool -change libz.1.dylib /opt/local/lib/libz.1.dylib /opt/local/lib/libfontconfig.1.dylib
sudo install_name_tool -change libz.1.dylib /opt/local/lib/libz.1.dylib /opt/local/lib/libcairo.2.dylib

# Build tools and libraries

cd ~/gtk2 && make clean && make distclean && git checkout gtk-2-24 && git pull --rebase && curl https://bug757187.bugzilla-attachments.gnome.org/attachment.cgi\?id=331173 | git apply && curl https://raw.githubusercontent.com/macports/macports-ports/master/gnome/gtk2/files/patch-gtk-builder-convert.diff | git apply && cd gtk && curl https://raw.githubusercontent.com/macports/macports-ports/master/gnome/gtk2/files/patch-aliases.diff | git apply && cd ../gdk && curl https://raw.githubusercontent.com/macports/macports-ports/master/gnome/gtk2/files/patch-aliases.diff | git apply && autoconf && CC=clang CXX=clang++ CXXFLAGS=" -DX_LOCALE" CFLAGS=" -fstrict-aliasing" sh autogen.sh --prefix=/opt/local && autoreconf -i && automake -a && CC=clang CXX=clang++ CFLAGS="-mtune=generic -v -fstrict-aliasing -arch x86_64 -I/opt/local/include -O3 -mmacosx-version-min=10.9 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk" CXXFLAGS=" -mtune=generic -v -fstrict-aliasing -arch x86_64 -I/opt/local/include -O3 -mmacosx-version-min=10.9 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk -DX_LOCALE" LDFLAGS="/opt/local/lib/libintl.8.dylib /opt/local/lib/libgettextlib-0.20.1.dylib /opt/local/lib/libiconv.2.dylib -bind_at_load -mtune=generic -v -L/opt/local/lib -fstrict-aliasing -arch x86_64 -O3 -mmacosx-version-min=10.9 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk" ./configure --enable-introspection=no --enable-quartz-relocation --disable-visibility --with-gdktarget=quartz --enable-xkb=no --without-x --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk --enable-man=no   || BASE_DEPENDENCIES_CFLAGS=-I/opt/local/include  CC=clang CXX=clang++ CFLAGS="-mtune=generic -v -fstrict-aliasing -arch x86_64 -I/opt/local/include -O3 -mmacosx-version-min=10.9 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk" CXXFLAGS=" -mtune=generic -v -fstrict-aliasing -arch x86_64 -I/opt/local/include -O3 -mmacosx-version-min=10.9 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk -DX_LOCALE" LDFLAGS=" -Wl,-rpath /opt/local/lib /opt/local/lib/libexpat.1.dylib /opt/local/lib/libintl.8.dylib /opt/local/lib/libgettextlib-0.20.1.dylib /opt/local/lib/libiconv.2.dylib -bind_at_load -mtune=generic -v -L/opt/local/lib -fstrict-aliasing -arch x86_64 -O3 -mmacosx-version-min=10.9 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk" ./configure --disable-dependency-tracking --disable-silent-rules --disable-glibtest --enable-quartz-relocation --disable-visibility --with-gdktarget=quartz --enable-xkb=no --without-x --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk --enable-man=no --enable-introspection=no  && CC=clang CXX=clang++ CFLAGS=" -std=c11 -mtune=generic -v -fstrict-aliasing -arch x86_64 -I/opt/local/include -O3 -mmacosx-version-min=10.9 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk" CXXFLAGS=" -mtune=generic -v -fstrict-aliasing -arch x86_64 -I/opt/local/include -O3 -mmacosx-version-min=10.9 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk -DX_LOCALE" LDFLAGS="/opt/local/lib/libintl.8.dylib /opt/local/lib/libgettextlib-0.20.1.dylib /opt/local/lib/libiconv.2.dylib -bind_at_load -mtune=generic -v  -Wl,-rpath /opt/local/lib -L/opt/local/lib -fstrict-aliasing -arch x86_64 -O3 -mmacosx-version-min=10.9 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk" make -j8 && install_name_tool -change libfreetype.6.dylib /opt/local/lib/libfreetype.6.dylib gtk/.libs/gtk-query-immodules-2.0 && install_name_tool -change libfreetype.6.dylib /opt/local/lib/libfreetype.6.dylib gdk/.libs/libgdk-quartz-2.0.0.dylib && for inputmodules in modules/input/.libs/*.so; do install_name_tool  -change libfreetype.6.dylib /opt/local/lib/libfreetype.6.dylib "${inputmodules}"; install_name_tool -add_rpath /opt/local/lib "${inputmodules}"; done && sudo make install

cd ~/gtk-mac-integration2 && make clean && make distclean && git checkout gtk-mac-integration-2.1.3 ||  autoconf && sh autogen.sh --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk --libdir=/opt/local/lib --disable-glibtest --enable-introspection=no --enable-python=no --with-gtk3 --with-gtk2 --with-libiconv-prefix=/opt/local/lib --with-libintl-prefix=/opt/local/lib && autoreconf -i && automake -a && CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" PKG_CONFIG_PATH=/opt/local/lib/pkgconfig CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 CC=clang CXX=clang++ LT_SYS_LIBRARY_PATH=/opt/local/lib ./configure --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk --libdir=/opt/local/lib --disable-glibtest --enable-introspection=no --enable-python=no --with-gtk3 --with-gtk2 --with-libiconv-prefix=/opt/local/lib --with-libintl-prefix=/opt/local/lib && sed -i -e 's/GETTEXT_MACRO_VERSION\ =\ 0.19/GETTEXT_MACRO_VERSION\ =\ 0.20/g' po/Makefile.in.in && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LT_SYS_LIBRARY_PATH=/opt/local/lib make -j8 && sudo make install

cd ~/gegl && curl https://raw.githubusercontent.com/OpenCL/GEGL-OpenCL/master/opencl/colors.cl.h -o opencl/colors.cl.h && curl https://raw.githubusercontent.com/OpenCL/GEGL-OpenCL/master/opencl/colors-8bit-lut.cl.h -o opencl/colors-8bit-lut.cl.h && curl https://raw.githubusercontent.com/OpenCL/GEGL-OpenCL/master/opencl/random.cl.h -o opencl/random.cl.h && curl https://raw.githubusercontent.com/Benitoite/GIMPdeps/master/gegl.patch | git apply && LD=ld CC=/usr/bin/clang CXX=/usr/bin/clang++ LIBRARY_PATH=/opt/local/lib meson setup  --cross-file=~/maccross  --prefix=/opt/local --buildtype=release  -Dintrospection=false --layout=mirror --default-library=both  _build .  && touch subprojects/poly2tri-c/what.c && LD=ld CC=/usr/bin/clang CXX=/usr/bin/clang++  ninja -j1 -v -C _build && sudo ninja -C _build -v install && sudo install_name_tool -add_rpath /opt/local/lib /opt/local/lib/gegl-0.4/jp2-load.dylib && sudo install_name_tool -add_rpath /opt/local/lib /opt/local/lib/gegl-0.4/tiff-save.dylib && sudo install_name_tool -add_rpath /opt/local/lib /opt/local/lib/gegl-0.4/jpg-save.dylib && sudo install_name_tool -add_rpath /opt/local/lib /opt/local/lib/gegl-0.4/png-save.dylib && sudo install_name_tool -add_rpath /opt/local/lib /opt/local/lib/gegl-0.4/png-load.dylib && sudo install_name_tool -add_rpath /opt/local/lib /opt/local/lib/gegl-0.4/jpg-load.dylib && sudo install_name_tool -add_rpath /opt/local/lib /opt/local/lib/gegl-0.4/tiff-load.dylib

cd ~/intltool && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig sh autogen.sh --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib &&  autoreconf -vfi && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib &&  CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig make -j8 && sudo make install

cd ~/gmp && autoreconf -vfi && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && make -j8 && sudo make install

cd ~/libunistring && autoreconf -vfi && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && make -j8 && sudo make install

cd ~/bdwgc && autoreconf -vfi && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && make -j8 && sudo make install

cd ~/guile && git checkout v2.3.0 && autoreconf -vfi && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && make -j8 && sed -i.bak "s/sed -e/sed -i '' -e/" libguile/Makefile && sed -i.bak "s/sed -e/sed -i '' -e/" Makefile && sudo make install
#### NOTE: guile takes an hour to generate.

cd ~/libunistring && autoreconf -vfi && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && make -j8 && sudo make install

cd ~/autogen && autoreconf -vfi && CC=clang ./configure ac_cv_func_utimensat=no --disable-debug --disable-silent-rules --disable-dependency-tracking --prefix=/opt/local && sed -i.bak "s/-Werror//" Makefile && sed -i.bak "s/-Werror//" autoopts/Makefile && make -j8 && sudo make install

# nettle requires MacTeX http://tug.org/cgi-bin/mactex-download/MacTeX.pkg
cd ~/nettle && export PATH=/Library/TeX/texbin:$PATH && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk --with-libintl-prefix=/opt/local/lib --disable-silent-rules && make -j8 && sudo make install

cd ~/libev4 && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && make -j8 && sudo make install

cd ~/libtasn1 && ./bootstrap && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include -std=c11" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && sed -i.bak "s/c_isdigit/isdigit/" lib/parser_aux.c && make -j8 && sudo make install

cd ~/p11-kit && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib  --without-trust-paths && sed -i.bak "s/MSGMERGE_FOR_MSGFMT_OPTION = --for-msgfmt/MSGMERGE_FOR_MSGFMT_OPTION =/" po/Makefile && make -j8 && sudo make install

cd ~/gnutls && autoreconf -vfi && curl https://raw.githubusercontent.com/darktable-org/darktable/master/packaging/macosx/gnutls-disable-connectx.diff -o connectx.patch && patch -p0 < connectx.patch && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-heartbeat-support --disable-static  --disable-silent-rules --disable-dependency-tracking gl_cv_func_ftello_works=yes  --enable-local-libopts  --disable-guile --enable-local-libopts --disable-doc --disable-optional-args  --enable-openssl-compatibility  && make -j8 LDFLAGS= install

cd ~/glib-networking && LD=ld CC=/usr/bin/clang CXX=/usr/bin/clang++ LIBRARY_PATH=/opt/local/lib meson setup  --cross-file=~/maccross  --prefix=/opt/local --buildtype=release  -Dintrospection=false --layout=mirror --default-library=both  _build . && sudo ninja -C _build && ninja -C _build install

cd ~/gexiv2 && LD=ld CC=/usr/bin/clang CXX=/usr/bin/clang++ LIBRARY_PATH=/opt/local/lib meson setup  --cross-file=~/maccross  --prefix=/opt/local --buildtype=release  -Dintrospection=false --layout=mirror --default-library=both  _build . && ninja -C _build && sudo ninja -C _build install

cd ~/libarchive && autoreconf -vfi && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install

cd ~/libpsl && git clone https://github.com/publicsuffix/list && LD=ld CC=/usr/bin/clang CXX=/usr/bin/clang++ LIBRARY_PATH=/opt/local/lib meson setup  --cross-file=~/maccross  --prefix=/opt/local --buildtype=release  -Dintrospection=disabled --layout=mirror --default-library=both  _build . && ninja -C _build && sudo ninja -C _build install

cd ~/libsoup && LD=ld CC=/usr/bin/clang CXX=/usr/bin/clang++ LIBRARY_PATH=/opt/local/lib meson setup  --cross-file=~/maccross  --prefix=/opt/local --buildtype=release  -Dintrospection=disabled --layout=mirror --default-library=both  _build . && ninja -C _build && sudo ninja -C _build install

cd ~/libgpg-error && cd doc && make stamp-vti && cd .. && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install

cd ~/libgcrypt && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static --disable-doc --disable-silent-rules && make -j8 && sudo make install

cd ~/libassuan && cd doc && make stamp-vti && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install

cd ~/libksba && cd doc && make stamp-vti && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install

cd ~/npth && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install

cd ~/gnupg && git apply ~/MacGPG2/patches/gnupg/* && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install

cd ~/file-5 && autoreconf -vfi && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install

cd ~/popt && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib  CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install

cd ~/db-4 && curl https://raw.githubusercontent.com/Benitoite/GIMPdeps/master/db-4.patch -o patch1 && patch -p0 < patch1 && cd build_unix && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ../dist/configure  --prefix=/opt/local && make -j8 && sudo make install

cd ~/lua-5 & sed -i.bak "s:PLAT = none:PLAT = macosx:" src/Makefile && sed -i.bak "s:MYCFLAGS =:MYCFLAGS= -arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include:" src/Makefile && sed -i.bak "s:MYLDFLAGS =:MYLDFLAGS= -arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib:" src/Makefile && make macosx && sudo make install

cd ~/rpm && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LUA_CFLAGS=-I/opt/local/include LUA_LIBS=-L/opt/local/lib sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LUA_CFLAGS=-I/opt/local/include LUA_LIBS=-L/opt/local/lib ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install && make -j8 && sudo make install

cd ~/libyaml && ./bootstrap && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install

cd ~/appstream-glib && LD=ld CC=/usr/bin/clang CXX=/usr/bin/clang++ LIBRARY_PATH=/opt/local/lib meson setup --cross-file=~/maccross  --prefix=/opt/local --buildtype=release   --layout=mirror --default-library=both -D stemmer=false -D instrospection=false _build . && ninja -C _build && sudo ninja -C _build install

cd ~/graphviz &&  CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LUA_CFLAGS=-I/opt/local/include LUA_LIBS=-L/opt/local/lib sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LUA_CFLAGS=-I/opt/local/include LUA_LIBS=-L/opt/local/lib ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install && make -j8 && sudo make install

cd ~/vala-0 && autoreconf -vfi &&  CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LUA_CFLAGS=-I/opt/local/include LUA_LIBS=-L/opt/local/lib ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules && make -j8 && sudo make install && make -j8 && sudo make install

cd ~/gexiv2 && LD=ld CC=/usr/bin/clang CXX=/usr/bin/clang++ LIBRARY_PATH=/opt/local/lib meson setup --cross-file=~/maccross  --prefix=/opt/local --buildtype=release --layout=mirror --default-library=both -D instrospection=false _build . && ninja -C _build && sudo ninja -C _build install

cd ~/json-c && mkdir build && cd build && DYLIB_CURRENT_VERSION=8.0.1 DYLIB_COMPATIBILITY_VERSION=7.0.0 cmake .. -DCMAKE_OSX_SYSROOT:PATH=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk -DCMAKE_OSX_DEPLOYMENT_TARGET:STRING=10.9 -DCMAKE_BUILD_TYPE:STRING=Release -DCMAKE_INSTALL_PREFIX:PATH=/opt/local && make -j8 && sudo make install

cd ~/libmypaint && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LUA_CFLAGS=-I/opt/local/include LUA_LIBS=-L/opt/local/lib sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LUA_CFLAGS=-I/opt/local/include LUA_LIBS=-L/opt/local/lib ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules --disable-introspection --enable-openmp && make -j8 && sudo make install && sudo install_name_tool -change libjson-c.5.dylib /opt/local/lib/libjson-c.5.dylib /opt/local/lib/libmypaint.0.dylib

cd ~/mypaint-brushes && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LUA_CFLAGS=-I/opt/local/include LUA_LIBS=-L/opt/local/lib sh autogen.sh  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python3 PKG_CONFIG_PATH=/opt/local/lib/pkgconfig LUA_CFLAGS=-I/opt/local/include LUA_LIBS=-L/opt/local/lib ./configure  --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --disable-static  --disable-silent-rules --disable-introspection --enable-openmp && make -j8 && sudo make install

cd ~/openjpeg && mkdir build && cd build && DYLIB_CURRENT_VERSION=8.0.1 DYLIB_COMPATIBILITY_VERSION=7.0.0 cmake .. -DCMAKE_OSX_SYSROOT:PATH=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk -DCMAKE_OSX_DEPLOYMENT_TARGET:STRING=10.9 -DCMAKE_BUILD_TYPE:STRING=Release -DCMAKE_INSTALL_PREFIX:PATH=/opt/local && make -j8 && sudo make install

cd ~/poppler && mkdir build && cd build && DYLIB_CURRENT_VERSION=8.0.1 DYLIB_COMPATIBILITY_VERSION=7.0.0 cmake .. -DCMAKE_OSX_SYSROOT:PATH=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk -DCMAKE_OSX_DEPLOYMENT_TARGET:STRING=10.9 -DCMAKE_BUILD_TYPE:STRING=Release -DCMAKE_INSTALL_PREFIX:PATH=/opt/local -DICONV_LIBRARIES=/opt/local/lib/libiconv.dylib && make -j8 || install_name_tool -add_rpath /opt/local/lib libpoppler.93.0.0.dylib && make -j8 && sudo make install

cd ~/poppler-data && mkdir build && cd build && DYLIB_CURRENT_VERSION=8.0.1 DYLIB_COMPATIBILITY_VERSION=7.0.0 cmake .. -DCMAKE_OSX_SYSROOT:PATH=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk -DCMAKE_OSX_DEPLOYMENT_TARGET:STRING=10.9 -DCMAKE_BUILD_TYPE:STRING=Release -DCMAKE_INSTALL_PREFIX:PATH=/opt/local -DICONV_LIBRARIES=/opt/local/lib/libiconv.dylib && make -j8 && sudo make install

# NOTE: mozjs68 requires OSX 10.11 minimum
cd ~/mozjs/js/src && mkdir obj && cd obj && sed -i.bak "s:-Wl,-executable_path,${DIST}/bin::" ../old-configure && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" AUTOCONF=autoconf PYTHON=python PKG_CONFIG_PATH=/opt/local/lib/pkgconfig APPSTREAM_GLIB_LIBS="-lappstream-glib -L/opt/local/lib" APPSTREAM_GLIB_CFLAGS="-I/opt/local/include" ../configure  --prefix=/opt/local --with-macos-sdk=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk --disable-xcode-checks --with-libclang-path=/Library/Developer/CommandLineTools/usr/lib --with-clang-path=/usr/bin/clang --disable-tests --with-system-icu --with-intl-api --disable-jemalloc --enable-release --enable-readline --enable-optimize --enable-shared-js && make -j8 && sudo make install &&  sudo install_name_tool -change  @executable_path/libmozglue.dylib /opt/local/lib/libmozglue.dylib /opt/local/lib/libmozjs-68.dylib && sudo install_name_tool -change @executable_path/libicui18n.64.dylib /opt/local/lib/libicui18n.64.dylib /opt/local/lib/libmozjs-68.dylib && sudo install_name_tool -change @executable_path/libicuuc.64.dylib /opt/local/lib/libicuuc.64.dylib /opt/local/lib/libmozjs-68.dylib && sudo install_name_tool -change @executable_path/libicudata.64.dylib /opt/local/lib/libicudata.64.dylib /opt/local/lib/libmozjs-68.dylib && sudo install_name_tool -change @executable_path/libicuuc.64.dylib /opt/local/lib/libicuuc.64.dylib /opt/local/lib/libicui18n.64.2.dylib && sudo install_name_tool -change @executable_path/libicudata.64.dylib /opt/local/lib/libicudata.64.dylib /opt/local/lib/libicui18n.64.2.dylib && sudo install_name_tool -change @executable_path/libicudata.64.dylib /opt/local/lib/libicudata.64.dylib /opt/local/lib/libicuuc.64.2.dylib

cd ~/gjs && LD=ld CC=/usr/bin/clang CXX=/usr/bin/clang++ LIBRARY_PATH=/opt/local/lib meson setup  --cross-file=~/maccross  --prefix=/opt/local --buildtype=release  -Dintrospection=disabled --layout=mirror --default-library=both -Dinstalled_tests=false -Dskip_gtk_tests=true -Dskip_dbus_tests=true -Dcairo=disabled _build . && ninja -C _build && sudo ninja -C _build install

cd ~/luajit-2.0 && MACOSX_DEPLOYMENT_TARGET=10.9 make PREFIX=/opt/local && sudo make install

# GIMP

cd ~/gimp && autoreconf -vfi && CC=clang CXX=clang++ CFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" LDFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -L/opt/local/lib -Wl,-rpath -Wl,/opt/local/lib" CPPFLAGS="-arch x86_64 -mmacosx-version-min=10.9 -I/opt/local/include" PYTHON=python PKG_CONFIG_PATH=/opt/local/lib/pkgconfig APPSTREAM_GLIB_LIBS="-lappstream-glib -L/opt/local/lib" APPSTREAM_GLIB_CFLAGS="-I/opt/local/include" ./configure --disable-python --disable-vector-icons --prefix=/opt/local --with-sysroot=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk  --with-libintl-prefix=/opt/local/lib --with-bug-report-url=https://discuss.pixls.us/c/software/gimp && make -j8 && sudo make install && sudo install_name_tool -change libgraphite2.3.dylib /opt/local/lib/libgraphite2.3.dylib $(which gimp) && sudo install_name_tool -change libz.1.dylib /opt/local/lib/libz.1.dylib $(which gimp) && sudo install_name_tool -change libjson-c.5.dylib /opt/local/lib/libjson-c.5.dylib $(which gimp)

# END OF SCRIPT
